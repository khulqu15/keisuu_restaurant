<!DOCTYPE html>
<html data-theme="light">

<head>
  <title>Food Menu</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="style/daisy.min.css" />
  <!-- Add Swiper CSS -->
  
  <link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css">
  <link href="https://cdn.jsdelivr.net/npm/daisyui@4.6.2/dist/full.min.css" rel="stylesheet" type="text/css" />
  <link rel="stylesheet" href="style/icon.css">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="translation.js" type="text/javascript" defer></script>
</head>

<body>
  <div class="max-h-screen flex overflow-hidden justify-center">
    <div class="max-w-lg overflow-x-hidden relative bg-orange-100 w-full min-h-screen">
    
      <div class="max-w-lg w-full bg-white rounded-b-xl shadow-lg grid grid-cols-2 items-center gap-x-2">
        <div class="py-2 px-4">
          <h2 class="font-semibold">Shwe Kan Kaw</h2>
        </div>
        <div class="p-2 flex items-center gap-2 justify-end">
          <div onclick="window.location.href = 'cart-revision.html'" id="food-cart-button" class="btn relative overflow-visible btn-sm text-white bg-orange-500">
            <span class="solar--cart-bold"></span> <span id="food-cart">Food Cart</span>
          </div>
          <label for="exit_modal" id="exit_modal_btn" class="btn btn-sm bg-red-500 text-white">
            <span class="ant-design--logout-outlined"></span> Exit
          </label>
        </div>
      </div>

      <input type="checkbox" id="exit_modal" class="modal-toggle">
      <div class="modal" role="dialog">
        <div class="modal-box max-w-sm">
          <label for="exit_modal" class="btn absolute right-0 top-0"><span class="solar--close-square-bold"></span></label>
          <div class="text-center pt-5">
            <div class="flex w-full items-center justify-center">
              <div class="w-8 h-8 rounded-full bg-red-500 text-white justify-center flex items-center">
                <span class="ant-design--logout-outlined"></span>
              </div>
            </div>
            <h3 class="font-bold text-lg">You wanna exit ?</h3>
            <p class="pb-4 pt-1">If you exit, you will lost your table and foods</p>
          </div>
          <div class="modal-action grid grid-cols-2">
            <div>
              <label for="exit_modal" class="btn w-full">Cancel</label>
            </div>
            <div>
              <label for="exit_modal" class="btn bg-red-500 text-white w-full" onclick="exitFromRestaurant()">Exit now</label>
            </div>
          </div>
        </div>
      </div>

      <!-- Caraousel Slider -->
      <div class="carousel w-full h-32">
        <div id="slide1" class="carousel-item relative w-full">
          <img src="img/banner1.jpg" class="w-full h-full object-center object-cover" alt="Image Banner">
          <div class="absolute flex justify-between transform -translate-1/2 left-5 right-5 top-1/2">
            <a href="#slide2" class="btn btn-circle opacity-60 btn-sm">❮</a> 
            <a href="#slide2" class="btn btn-circle opacity-60 btn-sm">❯</a>
          </div>
        </div>
        <div id="slide2" class="carousel-item relative w-full">
          <img src="img/banner2.jpg" class="w-full h-full object-center object-cover" alt="Image Banner">
          <div class="absolute flex justify-between transform -translate-1/2 left-5 right-5 top-1/2">
            <a href="#slide1" class="btn btn-circle opacity-60 btn-sm">❮</a> 
            <a href="#slide1" class="btn btn-circle opacity-60 btn-sm">❯</a>
          </div>
        </div>
      </div>

      <div class="w-full min-h-[72vh] bg-gradient-to-b from-orange-200 to-orange-100 p-4 pb-[10rem]">
        <div class="bg-orange-500 inline-block px-4 py-2 rounded-xl text-white font-bold mb-2">
            <div class="flex items-center gap-x-3">
                <span class="fluent--receipt-16-filled"></span> <span id="your_receipt_content">Your Receipt</span>
            </div>
        </div>
        <div class="p-3 rounded-xl bg-white">
            <div class="overflow-x-auto" id="table-checkout-content">
                <table class="table table-xs">
                  <thead>
                    <tr>
                      <th></th>
                      <th id="menu-header" class="text-black">Menu</th>
                      <th id="quantity-header" class="text-black">Quantity</th>
                      <th id="price-header" class="text-black text-right">Price</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <th>1</th>
                      <td>Beef Rices Noodles</td>
                      <td>1</td>
                      <td class="text-right">1100.00</td>
                    </tr>
                    <tr>
                      <th>2</th>
                      <td>Nasi Goreng</td>
                      <td>1</td>
                      <td class="text-right">1100.00</td>
                    </tr>
                    <tr>
                        <th></th>
                        <th></th>
                        <th id="tax-header">Tax</th>
                        <td class="text-right">10.00</td>
                    </tr>
                    <tr>
                        <th></th>
                        <th></th>
                        <th id="total-header">Total</th>
                        <td class="text-right">2210.00</td>
                    </tr>
                  </tbody>
                </table>
            </div>
        </div>
      </div>

      <input type="checkbox" id="paid_modal" class="modal-toggle">
      <div class="modal" role="dialog">
        <div class="modal-box max-w-sm">
          <label for="paid_modal" class="btn absolute right-0 top-0"><span class="solar--close-square-bold"></span></label>
          <div class="text-center pt-5">
            <div class="flex w-full items-center justify-center">
              <div class="w-8 h-8 rounded-full bg-green-500 text-white justify-center flex items-center">
                <span class="mingcute--send-fill"></span>
              </div>
            </div>
            <h3 class="font-bold text-lg">Are you sure ?</h3>
            <p class="pb-4 pt-1">Will you pay these foods now ?</p>
          </div>
          <div class="modal-action grid grid-cols-2">
            <div>
              <label for="paid_modal" class="btn w-full">Cancel</label>
            </div>
            <div>
              <label for="paid_modal" class="btn bg-green-500 text-white w-full" onclick="createPayment()">Yes</label>
            </div>
          </div>
        </div>
      </div>

      <div id="jp-lang" class="absolute transition-all bottom-0 opacity-0 right-32">
        <button onclick="changeLang('ja')" class="btn w-12 h-12 rounded-full bg-orange-600 hover:bg-orange-700 flex items-center justify-center text-white shadow-xl">JP</button>
      </div>
      <div id="en-lang" class="absolute transition-all bottom-0 opacity-0 right-32">
        <button onclick="changeLang('en')" class="btn w-12 h-12 rounded-full bg-orange-600 hover:bg-orange-700 flex items-center justify-center text-white shadow-xl">EN</button>
      </div>
      <div id="mm-lang" class="absolute transition-all bottom-0 opacity-0 right-32">
        <button onclick="changeLang('mm')" class="btn w-12 h-12 rounded-full bg-orange-600 hover:bg-orange-700 flex items-center justify-center text-white shadow-xl">MM</button>
      </div>  
      
      <div id="table-pin-content" class="transition-all absolute right-4 bottom-16 z-[15] hidden">
        <div class="absolute right-6 -top-4 w-12 h-6 bg-orange-500 rounded-t-2xl">
          <div class="absolute w-3 h-2 top-2 left-4 rounded-xl bg-orange-100"></div>
        </div>
        <div class="absolute right-5 -top-9">
          <img src="img/pin.png" class="w-8" alt="">
        </div>
        <div class="w-24 h-20 rounded-xl bg-white">
          <div class="w-full p-1 text-white rounded-lg bg-orange-500 flex justify-between items-center">
            <span class="text-sm ml-2" id="table-content">Table</span>
            <button class="p-1 py-0 bg-orange-500" id="table-pin-button">
              <span id="table-pin-button-icon" class="transition-all mingcute--down-fill"></span>
            </button>
          </div>
          <div class="text-4xl flex items-center justify-center font-semibold h-1/2" id="table_number">07</div>
        </div>
      </div>

      <div class="fixed bottom-0 left-0 flex w-full items-center justify-center z-20">
        <div class="max-w-lg w-full p-2 bg-white rounded-t-xl shadow-2xl grid grid-cols-4 items-center gap-x-2">
          <button class="btn btn-sm w-full btn-ghost" onclick="window.location.href = 'index-revision.html'">
            <span class="ic--round-menu-book md:inline-block hidden"></span> <span class="text-xs" id="menu">Menu</span>
          </button>
          <div class="btn btn-sm w-full" onclick="window.location.href = 'checkout-revision.html'">
            <span class="ic--round-shopping-cart-checkout hidden"></span> <span class="text-xs" id="checkout">Checkout</span>
          </div>
          <div class="btn btn-sm w-full btn-ghost" id="language-button">
            <span class="tabler--language hidden"></span> <span class="text-xs" id="language">Language</span>
          </div>
          <div class="btn btn-sm w-full btn-ghost">
            <span class="material-symbols--call md:inline-block hidden"></span> <span class="text-xs" id="call">Call</span>
          </div>
        </div>
      </div>

      <input type="checkbox" id="success_modal" class="modal-toggle">
      <div class="modal" role="dialog">
        <div class="modal-box max-w-sm">
          <div class="text-center pt-5">
            <div class="flex w-full items-center justify-center">
              <div class="w-8 h-8 rounded-full bg-green-500 text-white justify-center flex items-center">
                <span class="mingcute--send-fill"></span>
              </div>
            </div>
            <h3 class="font-bold text-lg">Thank you for your order</h3>
            <p class="pb-4 pt-1">Thanks and see you again</p>
          </div>
          <div class="modal-action grid grid-cols-1">
            <div>
              <label for="success_modal" class="btn bg-green-500 text-white w-full" onclick="window.location.href = `http://google.com`">Exit page</label>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>
</body>
</html>

<script src="component.js"></script>
<script>
let domain_endpoint = 'http://localhost:8000'
let foods = JSON.parse(sessionStorage.getItem('foods'))
let ordered = JSON.parse(sessionStorage.getItem('ordered'))
console.log(ordered)
let credentials = JSON.parse(sessionStorage.getItem('credentials'))
let lang = sessionStorage.getItem('language')
let foods_ordered = JSON.parse(sessionStorage.getItem('foods_ordered'))
let table_checkout_content = document.getElementById('table-checkout-content')
let sum_total = 0
if((foods_ordered != null || foods_ordered != undefined) && (ordered != null || ordered != undefined)) {
  let table_content = `
  <table class="table table-xs">
    <thead>
      <tr>
        <th></th>
        <th id="menu-header" class="text-black">Menu</th>
        <th id="quantity-header" class="text-black">Quantity</th>
        <th id="price-header" class="text-black text-right">Price</th>
      </tr>
    </thead>
    <tbody>`
  foods.map((element, index) => {
    let string_price = element.total.toString()
    let formatted_price = parseFloat(string_price.replace(',', ''))
    let order_food = foods_ordered.find((item) => item.food == element.id)
    sum_total += formatted_price
    table_content += `
    <tr>
      <th>${index + 1}</th>
      <td>
        <div class="flex items-center gap-2">
          <img src="${element.image}" class="w-10 h-10 rounded-xl object-cover object-center"/>
          <div>${lang == 'en' ? element.en : lang == 'ja' ? element.ja : element.mm}</div>
        </div>
      </td>
      <td>${element.unit}</td>
      <td class="text-right">${new Intl.NumberFormat('ja-JP').format(formatted_price)}.00</td>
    </tr>`
  })
  //<td>
  //  <span class="uppercase px-2 rounded-xl text-xs bg- ${order_food.status == 'pending' ? 'bg-red-500 text-white' : order_food.status == 'progress' ? 'bg-yellow-500 text-black' : 'bg-green-500 text-white'}">
  //    ${order_food.status}</td>
  //  </span>
  // </td>
  table_content += `
  <tr>
    <th></th>
    <th></th>
    <th id="tax-header">Tax</th>
    <td class="text-right">100.00</td>
  </tr>
  <tr>
    <th></th>
    <th></th>
    <th id="total-header">Total</th>
    <td class="text-right">${new Intl.NumberFormat('ja-JP').format((sum_total + 100))}.00</td>
  </tr>`
  table_content += `</tbody></table>`
  let checkAllOrder = foods_ordered.filter((item) => item.status != 'pending' && item.status != 'progress')
  console.log(checkAllOrder)
  if(checkAllOrder.length != foods_ordered.length) {
    table_content += `
    <div class="w-full text-white bg-green-600 shadow-xl rounded-xl text-xl mt-2 p-3">
      <span class="font-bold">This is Table ${credentials.table.number}</span>, Please provide the table number at the payment counter </span>
    </div>
    <div class="text-right mt-4">
      <label for="paid_modal" class="btn w-1/2 bg-orange-500 rounded-xl btn-sm text-white hover:bg-black" id="paid-button">Checkout</label>
    </div>`
  }
  table_checkout_content.innerHTML = table_content
} else {
  let table_content = `<div class="flex w-full items-center justify-center py-4">
    <div class="w-full bg-red-500 p-4 rounded-xl text-white flex items-center justify-between">
      <p>You never checkout some food</p>
      <button onclick="window.location.href = 'index-revision.html'" class="btn bg-white text-red-500 hover:bg-white/70 btn-sm border-0">Menu</button>
    </div>
  </div>`
  table_checkout_content.innerHTML = table_content
}

function createPayment() {
  fetch(domain_endpoint+'/api/1/foods/pay/'+ordered.id+'/', {
    method: 'POST',
    headers: {
      'Accept': 'application/json',
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({
      amount: (sum_total + 100)
    })
  })
  .then((response) => { return response.json() })
  .then((data) => {
    console.log(data)
    if(data.status == 'success') {
      document.getElementById('success_modal').click()
    }
  })
}

function paidFood() {
  fetch(domain_endpoint+'/api/1/table/'+credentials.table.id+'/done/', {
    method: 'GET',
    headers: {
      'Accept': 'application/json',
    }
  })
  .then((response) => { return response.json() })
  .then((data) => {
    if(data.status == 'success') {
      sessionStorage.removeItem('foods')
      sessionStorage.removeItem('ordered')
      sessionStorage.removeItem('credentials')
      sessionStorage.removeItem('language')
      sessionStorage.removeItem('checkout')
      document.getElementById('success_modal').click()
    }
  })
}

</script>